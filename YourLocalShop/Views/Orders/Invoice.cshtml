@model YourLocalShop.Models.ViewModels.InvoiceVm
@{
    ViewData["Title"] = "Invoice";
}

<h1 class="mb-3">Invoice</h1>
<p class="alert alert-info">Thank You for Your Order!</p>

<ul>
    <li><strong>Invoice ID:</strong> @(string.IsNullOrEmpty(Model.Order.InvoiceId) ? "Pending" : Model.Order.InvoiceId)</li>
    <li><strong>Date:</strong> @Model.Order.OrderDate.ToString("dd MMM yyyy")</li>
    <li><strong>Order ID:</strong> @Model.Order.Id</li>
    <li><strong>Name:</strong> @Model.Order.Customer.FirstName @Model.Order.Customer.LastName</li>
    <li><strong>Address:</strong>
        @(string.IsNullOrEmpty(Model.Order.Customer.Address.UnitNumber) ? "" : $"Unit {Model.Order.Customer.Address.UnitNumber}, ")
        @Model.Order.Customer.Address.StreetNumber @Model.Order.Customer.Address.StreetName,
        @Model.Order.Customer.Address.City, @Model.Order.Customer.Address.State @Model.Order.Customer.Address.PostCode,
        @Model.Order.Customer.Address.Country
    </li>
</ul>

<h3 class="mt-4">Order Details</h3>
<table class="table align-middle">
    <thead>
        <tr>
            <th>Product</th>
            <th class="text-end">Unit price</th>
            <th class="text-end">Quantity</th>
            <th class="text-end">Subtotal</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Order.Items)
        {
            <tr>
                <td>@item.Name</td>
                <td class="text-end">@item.UnitPrice.ToString("C")</td>
                <td class="text-end">@item.Quantity</td>
                <td class="text-end">@item.Subtotal.ToString("C")</td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <th colspan="3" class="text-end">Amount Due</th>
            <th class="text-end">@Model.Order.Total.ToString("C")</th>
        </tr>
    </tfoot>
</table>

<h3 class="mt-4">Payment</h3>
<form asp-action="Pay" asp-controller="Orders" method="post">
    @Html.AntiForgeryToken()

    <!-- Hidden field to carry OrderId -->
    <input type="hidden" name="OrderId" value="@Model.Order.Id" />

    <div class="mb-3">
        <label>Card Number</label>
        <input asp-for="Payment.CardNumber" class="form-control" />
        <span asp-validation-for="Payment.CardNumber"></span>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label>Expiry (MM/YY)</label>
            <input asp-for="Payment.Expiry" class="form-control" />
            <span asp-validation-for="Payment.Expiry"></span>
        </div>
        <div class="col-md-6 mb-3">
            <label>CVC</label>
            <input asp-for="Payment.CVC" class="form-control" />
            <span asp-validation-for="Payment.CVC"></span>
        </div>
    </div>

    <button type="submit" class="btn btn-success">Pay</button>
</form>
